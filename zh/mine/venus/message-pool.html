<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Venus Miner: the message pool | 启明星</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/assets/venus-logo.png">
    <meta name="description" content="The Message Pool (mpool) is the component of venus that handles pending messages for inclusion in the chain.">
    
    <link rel="preload" href="/assets/css/0.styles.a114b18c.css" as="style"><link rel="preload" href="/assets/js/app.d53fd740.js" as="script"><link rel="preload" href="/assets/js/2.8617ae3b.js" as="script"><link rel="preload" href="/assets/js/112.9544de2a.js" as="script"><link rel="prefetch" href="/assets/js/10.111166b4.js"><link rel="prefetch" href="/assets/js/100.d3f6ae88.js"><link rel="prefetch" href="/assets/js/101.3cca01a5.js"><link rel="prefetch" href="/assets/js/102.ae215869.js"><link rel="prefetch" href="/assets/js/103.b34e2ea3.js"><link rel="prefetch" href="/assets/js/104.ee8abb32.js"><link rel="prefetch" href="/assets/js/105.0399c892.js"><link rel="prefetch" href="/assets/js/106.45170f91.js"><link rel="prefetch" href="/assets/js/107.d5838c60.js"><link rel="prefetch" href="/assets/js/108.10eaafcc.js"><link rel="prefetch" href="/assets/js/109.a495b0c8.js"><link rel="prefetch" href="/assets/js/11.2a5fad88.js"><link rel="prefetch" href="/assets/js/110.ec214f41.js"><link rel="prefetch" href="/assets/js/111.75cef343.js"><link rel="prefetch" href="/assets/js/113.9506cfce.js"><link rel="prefetch" href="/assets/js/114.bff442f7.js"><link rel="prefetch" href="/assets/js/115.c48ad496.js"><link rel="prefetch" href="/assets/js/116.605fe29a.js"><link rel="prefetch" href="/assets/js/117.a9e5c270.js"><link rel="prefetch" href="/assets/js/118.fcb0cd4e.js"><link rel="prefetch" href="/assets/js/119.e1d22475.js"><link rel="prefetch" href="/assets/js/12.f7fa6afb.js"><link rel="prefetch" href="/assets/js/120.c1a0a96b.js"><link rel="prefetch" href="/assets/js/121.82841a6e.js"><link rel="prefetch" href="/assets/js/122.cd235e26.js"><link rel="prefetch" href="/assets/js/123.8e6d40eb.js"><link rel="prefetch" href="/assets/js/124.5482452c.js"><link rel="prefetch" href="/assets/js/125.6e64490d.js"><link rel="prefetch" href="/assets/js/126.1e12fa20.js"><link rel="prefetch" href="/assets/js/127.4de7ce21.js"><link rel="prefetch" href="/assets/js/128.0bf005f5.js"><link rel="prefetch" href="/assets/js/129.fa3a20ea.js"><link rel="prefetch" href="/assets/js/13.c5dce2f4.js"><link rel="prefetch" href="/assets/js/130.367dd0dd.js"><link rel="prefetch" href="/assets/js/131.87d5e6a8.js"><link rel="prefetch" href="/assets/js/14.eb56cfb9.js"><link rel="prefetch" href="/assets/js/15.e4e38e0a.js"><link rel="prefetch" href="/assets/js/16.afcee0fd.js"><link rel="prefetch" href="/assets/js/17.d039b08e.js"><link rel="prefetch" href="/assets/js/18.a306f4ea.js"><link rel="prefetch" href="/assets/js/19.b6dcbc32.js"><link rel="prefetch" href="/assets/js/20.9cdf54ab.js"><link rel="prefetch" href="/assets/js/21.c5dd6ac4.js"><link rel="prefetch" href="/assets/js/22.8e5ed93d.js"><link rel="prefetch" href="/assets/js/23.1d5455df.js"><link rel="prefetch" href="/assets/js/24.ced97e0d.js"><link rel="prefetch" href="/assets/js/25.34a11ac9.js"><link rel="prefetch" href="/assets/js/26.d410fcd2.js"><link rel="prefetch" href="/assets/js/27.6b78727f.js"><link rel="prefetch" href="/assets/js/28.90bdebb9.js"><link rel="prefetch" href="/assets/js/29.baad5aa2.js"><link rel="prefetch" href="/assets/js/3.dbde2733.js"><link rel="prefetch" href="/assets/js/30.86e72097.js"><link rel="prefetch" href="/assets/js/31.9b9a5077.js"><link rel="prefetch" href="/assets/js/32.a951f18f.js"><link rel="prefetch" href="/assets/js/33.6e8cd6c4.js"><link rel="prefetch" href="/assets/js/34.986d8a07.js"><link rel="prefetch" href="/assets/js/35.5bc35407.js"><link rel="prefetch" href="/assets/js/36.31141803.js"><link rel="prefetch" href="/assets/js/37.218cdea7.js"><link rel="prefetch" href="/assets/js/38.2705fc31.js"><link rel="prefetch" href="/assets/js/39.a534c0fa.js"><link rel="prefetch" href="/assets/js/4.ff758141.js"><link rel="prefetch" href="/assets/js/40.4555eaa9.js"><link rel="prefetch" href="/assets/js/41.245d760f.js"><link rel="prefetch" href="/assets/js/42.4fd7e9c6.js"><link rel="prefetch" href="/assets/js/43.2cc4ad4a.js"><link rel="prefetch" href="/assets/js/44.f3402d14.js"><link rel="prefetch" href="/assets/js/45.b6e4110e.js"><link rel="prefetch" href="/assets/js/46.dd99f150.js"><link rel="prefetch" href="/assets/js/47.10941645.js"><link rel="prefetch" href="/assets/js/48.dff1181f.js"><link rel="prefetch" href="/assets/js/49.5b303532.js"><link rel="prefetch" href="/assets/js/5.b9e15c35.js"><link rel="prefetch" href="/assets/js/50.95471517.js"><link rel="prefetch" href="/assets/js/51.4b83ba1c.js"><link rel="prefetch" href="/assets/js/52.74b1145c.js"><link rel="prefetch" href="/assets/js/53.619cc663.js"><link rel="prefetch" href="/assets/js/54.fcc08d10.js"><link rel="prefetch" href="/assets/js/55.6a1a939d.js"><link rel="prefetch" href="/assets/js/56.0bcb0541.js"><link rel="prefetch" href="/assets/js/57.2cbd4f15.js"><link rel="prefetch" href="/assets/js/58.6e5f63da.js"><link rel="prefetch" href="/assets/js/59.d1e9de18.js"><link rel="prefetch" href="/assets/js/6.d0202783.js"><link rel="prefetch" href="/assets/js/60.737af0a1.js"><link rel="prefetch" href="/assets/js/61.d0b26b65.js"><link rel="prefetch" href="/assets/js/62.b86165b9.js"><link rel="prefetch" href="/assets/js/63.22511c41.js"><link rel="prefetch" href="/assets/js/64.e39604be.js"><link rel="prefetch" href="/assets/js/65.012e8dcb.js"><link rel="prefetch" href="/assets/js/66.8d3e09b8.js"><link rel="prefetch" href="/assets/js/67.329a6b6b.js"><link rel="prefetch" href="/assets/js/68.a2b2feba.js"><link rel="prefetch" href="/assets/js/69.0e2d80ca.js"><link rel="prefetch" href="/assets/js/7.e8e7db61.js"><link rel="prefetch" href="/assets/js/70.0067da30.js"><link rel="prefetch" href="/assets/js/71.818a1630.js"><link rel="prefetch" href="/assets/js/72.ed8fe8ff.js"><link rel="prefetch" href="/assets/js/73.60caf8ab.js"><link rel="prefetch" href="/assets/js/74.7c0e69cc.js"><link rel="prefetch" href="/assets/js/75.103aeb4c.js"><link rel="prefetch" href="/assets/js/76.9c6dbb2f.js"><link rel="prefetch" href="/assets/js/77.d463869e.js"><link rel="prefetch" href="/assets/js/78.6e73bc5d.js"><link rel="prefetch" href="/assets/js/79.f4fc6432.js"><link rel="prefetch" href="/assets/js/8.943efc13.js"><link rel="prefetch" href="/assets/js/80.eabe7152.js"><link rel="prefetch" href="/assets/js/81.423ae20f.js"><link rel="prefetch" href="/assets/js/82.c32358c2.js"><link rel="prefetch" href="/assets/js/83.f2f77e2b.js"><link rel="prefetch" href="/assets/js/84.9d700d55.js"><link rel="prefetch" href="/assets/js/85.a9de7e9a.js"><link rel="prefetch" href="/assets/js/86.7ce050b3.js"><link rel="prefetch" href="/assets/js/87.73e3878a.js"><link rel="prefetch" href="/assets/js/88.f65c5a61.js"><link rel="prefetch" href="/assets/js/89.8ad49cda.js"><link rel="prefetch" href="/assets/js/9.92cc4899.js"><link rel="prefetch" href="/assets/js/90.f42cac5e.js"><link rel="prefetch" href="/assets/js/91.d0774e0b.js"><link rel="prefetch" href="/assets/js/92.45d89cfa.js"><link rel="prefetch" href="/assets/js/93.f6777f3c.js"><link rel="prefetch" href="/assets/js/94.b552b86f.js"><link rel="prefetch" href="/assets/js/95.6e234d6a.js"><link rel="prefetch" href="/assets/js/96.a4f92e48.js"><link rel="prefetch" href="/assets/js/97.75a4fb4d.js"><link rel="prefetch" href="/assets/js/98.deff09ad.js"><link rel="prefetch" href="/assets/js/99.92c344ff.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a114b18c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/assets/venus-logo-title.svg" alt="启明星" class="logo"> <span class="site-name can-hide">启明星</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/guide/" class="nav-link">
  快速上手
</a></div><div class="nav-item"><a href="/zh/modules/" class="nav-link">
  组件模块
</a></div><div class="nav-item"><a href="/zh/advanced/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/zh/incubation/" class="nav-link">
  孵化器
</a></div><div class="nav-item"><a href="/zh/master/" class="nav-link">
  Master
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mine/venus/message-pool.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/mine/venus/message-pool.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/guide/" class="nav-link">
  快速上手
</a></div><div class="nav-item"><a href="/zh/modules/" class="nav-link">
  组件模块
</a></div><div class="nav-item"><a href="/zh/advanced/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/zh/incubation/" class="nav-link">
  孵化器
</a></div><div class="nav-item"><a href="/zh/master/" class="nav-link">
  Master
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mine/venus/message-pool.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/mine/venus/message-pool.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="frontmatter-title"><a href="#frontmatter-title" class="header-anchor">#</a> Venus Miner: the message pool</h1> <p>The Message Pool (mpool) is the component of venus that handles pending messages for inclusion in the chain. Messages are added to the mpool either directly for locally published messages or through pubsub propagation. Whenever a miner is ready to create a block for a tipset, it invokes the mpool selection algorithm which selects an appropriate set of messages such that it optimizes miner reward and chain capacity.</p> <p>When messages are executed, they use <em>gas</em>. The amount of <em>gas</em> used, the parameters attached to each message and the Network's current <em>BaseFee</em> determine the final FIL-cost to include the transaction in the chain. Part of that cost is burned by the network. The other part is given to the miner of the first block that includes the transaction as a reward.</p> <p>The different caps and fees for messages are explained below, along with instructions on how to inspect and interact with the message pool.</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>Venus provides the tooling to interact with the message pool with the <code>venus mpool</code> subcommands.</p></div> <p></p><div class="table-of-contents"><ul><li><a href="#message-selection">Message selection</a></li><li><a href="#gas-fees-limits-and-caps">Gas, fees, limits and caps</a></li><li><a href="#checking-for-pending-messages">Checking for pending messages</a></li><li><a href="#replacing-messages-in-the-pool">Replacing messages in the pool</a></li></ul></div><p></p> <h2 id="message-selection"><a href="#message-selection" class="header-anchor">#</a> Message selection</h2> <p>When mining a new block, miners must select a set of messages for inclusion in a way that maximizes the reward. Given how message distribution works, using pubsub, and that miners do not communicate their tickets to each other, it is not possible to fully determine if a different miner will also include the message on a different block in the new tipset, and perhaps get the reward instead if their block executes first. The problem is NP-hard (an instance of knapsack packing) so, at best, an approximation can be made to the optimal selection in a reasonable amount of time.</p> <p>Venus employs a sophisticated algorithm for selecting messages for inclusion from the pool, given the ticket quality of a miner. The ticket quality reflects the probability of execution order for a block in the tipset. Given the ticket quality the algorithm computes the probability of each block, and picks dependent chains of messages such that the reward is maximized, while also optimizing the capacity of the chain.</p> <p>If the ticket quality is sufficiently high, then a greedy selection algorithm is used instead that simply picks dependent chains of maximum reward. Note that pending message chains from priority addresses are always selected, regardless of their profitability.</p> <h2 id="gas-fees-limits-and-caps"><a href="#gas-fees-limits-and-caps" class="header-anchor">#</a> Gas, fees, limits and caps</h2> <p>When a message is executed it consumes <em>gas</em>. The total gas consumed by a message directly affects the cost to place that message in the blockchain, which is a price that the sender will have to pay.</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>Venus can be configured with several addresses to have more granular control over fees and limits depending on the operation and avoid head-of-line blocking, particularly for high value operations such as <em>WindowPoSts</em>. Check the <a href="/zh/mine/venus/miner-addresses.html">miner addresses guide</a>.</p></div> <p>As an additional tip, you can use Lotus to find out about the current <em>BaseFee</em>:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Will print the last BaseFee in attoFIL</span>
venus chain <span class="token function">head</span> <span class="token operator">|</span> <span class="token function">xargs</span> venus chain getblock <span class="token operator">|</span> jq -r .ParentBaseFee
</code></pre></div><h2 id="checking-for-pending-messages"><a href="#checking-for-pending-messages" class="header-anchor">#</a> Checking for pending messages</h2> <p>If messages are not deemed attractive enough by miners to be included in new blocks, they may become stuck in the message pool. This is usually a consequence of the <em>GasFeeCap</em> being too low, for example, when the Network's <em>BaseFee</em> is high. It can also be a consequence of the <em>GasPremium</em> being too low if the network is congested.</p> <p>You can check for messages currently in the pool and specifically sent by your node with:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>venus mpool pending --local
</code></pre></div><p>For each message you will be able to see key information like the <em>GasLimit</em>, the <em>GasFeeCap</em> and the <em>GasPremium</em> values, explained above.</p> <p>To reduce the output to the messages key values you can use:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>venus mpool pending --local <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;Nonce&quot;</span> -A5
</code></pre></div><p>In order to avoid messages from staying long periods in the pool when they are sent, it is possible to adjust the <a href="/zh/mine/venus/sealer-configuration.html">Venus Miner fees in the configuration</a> and use <a href="/zh/mine/venus/miner-addresses.html">additional control addresses for <em>WindowPoSts</em></a>. Existing messages can be replaced at any time with the procedure explained below.</p> <h2 id="replacing-messages-in-the-pool"><a href="#replacing-messages-in-the-pool" class="header-anchor">#</a> Replacing messages in the pool</h2> <p>You can replace messages in the pool by pushing a new message with the same <code>Nonce</code> that has a <strong>new <code>GasPremium</code> that is at least 25% larger than that of the original message</strong>. To this effect, the easiest is to use:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>venus mpool replace --auto <span class="token operator">&lt;</span>from<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>nonce<span class="token operator">&gt;</span>
</code></pre></div><p>The above command will replace the associated message in the pool and automatically reprice it with a new <em>GasPremium</em> and <em>GasFeeCap</em> as estimated from the current network conditions. You can also set <code>--max-fee</code> if you wish to limit the total amount to spend for the message. All other flags are ignored.</p> <p>Alternatively, the <em>GasPremium</em>, <em>GasFeeCap</em> can be set manually with their respective flags:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>venus mpool replace --gas-feecap <span class="token operator">&lt;</span>feecap<span class="token operator">&gt;</span> --gas-premium <span class="token operator">&lt;</span>premium<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>from<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>nonce<span class="token operator">&gt;</span>
</code></pre></div><p>If the new <em>gas premium</em> is lower than the 1.25 ratio to the original, the message will not be included in the pool. Additional message fields, like the recipient of the transaction, can be changed when using the <code>MpoolPush</code> API method directly. In this case the new message will need to be locally signed first.</p> <p>The <em>GasLimit</em> should not be changed under normal circumstances. For instructions on how to use the optional flag to replace the <em>GasLimit</em> please consult</p> <div class="language-sh extra-class"><pre class="language-sh"><code>venus mpool replace --help
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/filecoin-project/venus-docs/edit/master/docs/zh/mine/venus/message-pool.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2021/6/25 下午6:07:40</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d53fd740.js" defer></script><script src="/assets/js/2.8617ae3b.js" defer></script><script src="/assets/js/112.9544de2a.js" defer></script>
  </body>
</html>
